(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[49],{676:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>n});var t=a(5155),r=a(2115);let c="/api/encuesta",l=(e,s)=>"".concat(e.replace(/\/+$/,""),"/").concat(String(s).replace(/^\/+/,""));async function i(e,s){let a=await fetch(e,s);if((a.headers.get("content-type")||"").includes("application/json")){let e=await a.json();if(!a.ok||!1===e.ok)throw Error(e.error||"HTTP ".concat(a.status));return e}throw Error((await a.text()).slice(0,300)||"Respuesta no JSON")}function n(){let[e,s]=(0,r.useState)([]),[a,n]=(0,r.useState)(!1),[d,o]=(0,r.useState)(""),[x,m]=(0,r.useState)(null),[h,p]=(0,r.useState)(null),u=async()=>{try{n(!0),o("");let e=await i(l(c,"servicios"));s(e.servicios||[])}catch(e){o(e.message)}finally{n(!1)}},b=async e=>{try{n(!0),o("");let s=await i(l(c,"promedio/".concat(encodeURIComponent(e))));p(s),m(e)}catch(e){o(e.message)}finally{n(!1)}};(0,r.useEffect)(()=>{u()},[]);let j=(0,r.useMemo)(()=>e.map(e=>({servicio:e.servicio,encuestas:e.encuestas,registros:e.registros,ultima_fecha:e.ultima_fecha})),[e]);return(0,t.jsx)("main",{className:"min-h-screen bg-gray-100 text-gray-800 py-6 px-4",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-12 gap-6",children:[(0,t.jsx)("aside",{className:"md:col-span-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow border border-gray-200",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Servicios"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("a",{href:l(c,"export"),className:"text-sm px-3 py-1 rounded border hover:bg-gray-50",children:"Exportar Excel"}),(0,t.jsx)("button",{onClick:()=>{m(null),p(null),u()},className:"text-sm px-3 py-1 rounded border hover:bg-gray-50",children:"Actualizar"})]})]}),a&&!h&&(0,t.jsx)("div",{className:"p-4 text-sm text-gray-500",children:"Cargando..."}),d&&(0,t.jsxs)("div",{className:"p-4 text-sm text-red-600 break-words",children:["Error: ",d]}),(0,t.jsxs)("ul",{className:"divide-y",children:[0===j.length&&!a&&!d&&(0,t.jsx)("li",{className:"p-4 text-sm text-gray-500",children:"Sin datos"}),j.map(e=>(0,t.jsx)("li",{children:(0,t.jsx)("button",{onClick:()=>b(e.servicio),className:function(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return s.filter(Boolean).join(" ")}("w-full text-left p-4 hover:bg-blue-50 transition",x===e.servicio&&"bg-blue-50"),children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.servicio}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:["Encuestas: ",e.encuestas," â€¢ Registros: ",e.registros]})]}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:e.ultima_fecha?new Date(e.ultima_fecha).toLocaleString():"-"})]})})},e.servicio))]})]})}),(0,t.jsx)("section",{className:"md:col-span-8",children:(0,t.jsx)("div",{className:"bg-white rounded-xl shadow border border-gray-200 p-4 md:p-6",children:h?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:h.servicio}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Encuestas recibidas: ",h.encuestas]})]}),(0,t.jsx)("button",{onClick:()=>p(null),className:"text-sm px-3 py-1 rounded border hover:bg-gray-50",children:"Cerrar"})]}),(0,t.jsx)("div",{className:"overflow-auto",children:(0,t.jsxs)("table",{className:"min-w-full text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50",children:[(0,t.jsx)("th",{className:"text-left px-3 py-2 border-b",children:"#"}),(0,t.jsx)("th",{className:"text-left px-3 py-2 border-b",children:"Secci\xf3n"}),(0,t.jsx)("th",{className:"text-left px-3 py-2 border-b",children:"Pregunta"}),(0,t.jsx)("th",{className:"text-center px-3 py-2 border-b",children:"Promedio"}),(0,t.jsx)("th",{className:"text-center px-3 py-2 border-b",children:"Resp."}),[1,2,3,4,5].map(e=>(0,t.jsx)("th",{className:"text-center px-3 py-2 border-b",children:e},e))]})}),(0,t.jsx)("tbody",{children:h.preguntas.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-3 py-2 border-b",children:e.pregunta_id}),(0,t.jsx)("td",{className:"px-3 py-2 border-b",children:e.seccion}),(0,t.jsx)("td",{className:"px-3 py-2 border-b",children:e.pregunta}),(0,t.jsx)("td",{className:"px-3 py-2 border-b text-center font-semibold",children:e.promedio.toFixed(2)}),(0,t.jsx)("td",{className:"px-3 py-2 border-b text-center",children:e.respuestas}),[1,2,3,4,5].map(s=>(0,t.jsx)("td",{className:"px-3 py-2 border-b text-center",children:e.dist[String(s)]},s))]},e.pregunta_id))})]})}),(0,t.jsxs)("div",{className:"mt-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Comentarios recientes"}),0===h.comentarios.length?(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Sin comentarios."}):(0,t.jsx)("ul",{className:"space-y-3",children:h.comentarios.map(e=>(0,t.jsxs)("li",{className:"border rounded-lg p-3",children:[(0,t.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:new Date(e.created_at).toLocaleString()}),e.fortaleza&&(0,t.jsxs)("p",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Fortaleza:"})," ",e.fortaleza]}),e.area_oportunidad&&(0,t.jsxs)("p",{className:"text-sm mt-1",children:[(0,t.jsx)("span",{className:"font-medium",children:"\xc1rea de oportunidad:"})," ",e.area_oportunidad]})]},"".concat(e.encuesta_id,"-").concat(e.created_at)))})]})]}):(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Selecciona un servicio para ver resultados promediados."})})})]})})}},4260:(e,s,a)=>{Promise.resolve().then(a.bind(a,676))}},e=>{e.O(0,[441,255,358],()=>e(e.s=4260)),_N_E=e.O()}]);